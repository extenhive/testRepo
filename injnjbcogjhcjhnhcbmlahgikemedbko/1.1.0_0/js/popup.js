(()=>{var t={1:t=>{t.exports=function(){let t=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,e=/[\/\?<>\\:\*\|"~]/g,n=/[\x00-\x1f\x80-\x9f]/g,o=/^\.+/,i=/^(.+)\.([a-z0-9]{1,4})$/i,a=/^[^.!?]+/i,r="nbsp,iexcl,cent,pound,curren,yen,brvbar,sect,uml,copy,ordf,laquo,not,shy,reg,macr,deg,plusmn,sup2,sup3,acute,micro,para,middot,cedil,sup1,ordm,raquo,frac14,frac12,frac34,iquest,Agrave,Aacute,Acirc,Atilde,Auml,Aring,AElig,Ccedil,Egrave,Eacute,Ecirc,Euml,Igrave,Iacute,Icirc,Iuml,ETH,Ntilde,Ograve,Oacute,Ocirc,Otilde,Ouml,times,Oslash,Ugrave,Uacute,Ucirc,Uuml,Yacute,THORN,szlig,agrave,aacute,acirc,atilde,auml,aring,aelig,ccedil,egrave,eacute,ecirc,euml,igrave,iacute,icirc,iuml,eth,ntilde,ograve,oacute,ocirc,otilde,ouml,divide,oslash,ugrave,uacute,ucirc,uuml,yacute,thorn,yuml".split(","),c=[["amp","quot","lt","gt"],[38,34,60,62]],s=/&([^;]{2,6});/g,d=/\r?\n/g,u=/[\*\?"]/g,l=/</g,_=/>/g,m=/[\s\t\uFEFF\xA0]+/g,f=/(\.|!|\?|_|,|\-|:|\+){2,}/g,v=/[\.,:;\/\-_\+=']$/g,p=55,g=function(e){return e.replace(t,"")},h=function(t){return t.match(i)},w=function(t){var e=/\\(\\u[0-9a-f]{4})/g;try{return JSON.parse(JSON.stringify(t).replace(e,"$1"))}catch(e){return t}},k=function(t){return t.replace(s,(function(t,e){var n=null;if("#"===e[0])return n=parseInt(e.substr(1)),isNaN(n)?"":String.fromCharCode(n);var o=c[0].indexOf(e);return-1!==o?(n=c[1][o],String.fromCharCode(n)):-1!==(o=r.indexOf(e))?(n=o+160,String.fromCharCode(n)):""}))};return{t:function(t,e,n,o){const i=o?".mp4":".jpeg";let a="video_keeper_"+(e=e?`${e}_`:""),r;if(n=n?`_${this.i(n)}`:"")r=this.u(a+n)+i;else if(t)try{let e=new URL(t);r=null==e.searchParams.get("br")?a+e.pathname.split("/")[1]+"_"+(e.pathname.split("/")[3]||"")+i:a+e.searchParams.get("br")+"_"+e.searchParams.get("bt")+i}catch(t){}return r||(r=a+Math.round(1e5*Math.random())+i),r},u:t=>t.slice(0,p),i:function(t){if(!t)return"";t=w(t);try{t=decodeURIComponent(t)}catch(e){t=unescape(t)}return t=(t=k(t)).replace(d," "),(t=(t=(t=g(t)).replace(u,"").replace(l,"(").replace(_,")").replace(m," ").replace(f,"$1").replace(e,"_").replace(n,"").replace(o,"").replace(v,"")).replace(/[^\p{L}\p{N}\p{P}\p{Z}^$\n]/gu,"")).length<=p?t:t=(t=t.match(a))&&t[0]}}}()},2:t=>{t.exports=function(){return{l:"26.1.3",_:"260103",m:1,v:2,p:3,h:4,k:5,$:6,O:7,T:1988}}()},13:function(t){var e=e||"undefined"!=typeof navigator&&navigator.msSaveOrOpenBlob&&navigator.msSaveOrOpenBlob.bind(navigator)||function(t){if("undefined"==typeof navigator||!/MSIE [1-9]\./.test(navigator.userAgent)){var e=t.document,n=function(){return t.URL||t.webkitURL||t},o=t.URL||t.webkitURL||t,i=e.createElementNS("http://www.w3.org/1999/xhtml","a"),a=!t.externalHost&&"download"in i,r=function(n){var o=e.createEvent("MouseEvents");o.initMouseEvent("click",!0,!1,t,0,0,0,0,0,!1,!1,!1,!1,0,null),n.dispatchEvent(o)},c=t.webkitRequestFileSystem,s=t.requestFileSystem||c||t.mozRequestFileSystem,d=function(e){(t.setImmediate||t.setTimeout)((function(){throw e}),0)},u="application/octet-stream",l=0,_=[],m=function(){for(var t=_.length;t--;){var e=_[t];"string"==typeof e?o.revokeObjectURL(e):e.remove()}_.length=0},f=function(t,e,n){for(var o=(e=[].concat(e)).length;o--;){var i=t["on"+e[o]];if("function"==typeof i)try{i.call(t,n||t)}catch(t){d(t)}}},v=function(o,r){var d=this,m=o.type,v=!1,p,g,h=function(){var t=n().createObjectURL(o);return _.push(t),t},w=function(){f(d,"writestart progress write writeend".split(" "))},k=function(){!v&&p||(p=h(o)),g?g.location.href=p:window.open(p,"_blank"),d.readyState=d.DONE,w()},$=function(t){return function(){if(d.readyState!==d.DONE)return t.apply(this,arguments)}},b={create:!0,exclusive:!1},y;if(d.readyState=d.INIT,r||(r="download"),a){p=h(o),e=t.document,(i=e.createElementNS("http://www.w3.org/1999/xhtml","a")).href=p,i.download=r;var x=e.createEvent("MouseEvents");return x.initMouseEvent("click",!0,!1,t,0,0,0,0,0,!1,!1,!1,!1,0,null),i.dispatchEvent(x),d.readyState=d.DONE,void w()}t.chrome&&m&&m!==u&&(y=o.slice||o.webkitSlice,o=y.call(o,0,o.size,u),v=!0),c&&"download"!==r&&(r+=".download"),(m===u||c)&&(g=t),s?(l+=o.size,s(t.TEMPORARY,l,$((function(t){t.root.getDirectory("saved",b,$((function(t){var e=function(){t.getFile(r,b,$((function(t){t.createWriter($((function(e){e.onwriteend=function(e){g.location.href=t.toURL(),_.push(t),d.readyState=d.DONE,f(d,"writeend",e)},e.onerror=function(){var t=e.error;t.code!==t.ABORT_ERR&&k()},"writestart progress write abort".split(" ").forEach((function(t){e["on"+t]=d["on"+t]})),e.write(o),d.abort=function(){e.abort(),d.readyState=d.DONE},d.readyState=d.WRITING})),k)})),k)};t.getFile(r,{create:!1},$((function(t){t.remove(),e()})),$((function(t){t.code===t.NOT_FOUND_ERR?e():k()})))})),k)})),k)):k()},p=v.prototype,g=function(t,e){return new v(t,e)};return p.abort=function(){var t=this;t.readyState=t.DONE,f(t,"abort")},p.readyState=p.INIT=0,p.WRITING=1,p.DONE=2,p.error=p.onwritestart=p.onprogress=p.onwrite=p.onabort=p.onerror=p.onwriteend=null,t.addEventListener("unload",m,!1),g.unload=function(){m(),t.removeEventListener("unload",m,!1)},g}}("undefined"!=typeof self&&self||"undefined"!=typeof window&&window||this.content);t.exports=e}},e={};function n(o){var i=e[o];if(void 0!==i)return i.exports;var a=e[o]={exports:{}};return t[o].call(a.exports,a,a.exports,n),a.exports}(()=>{n.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return n.d(e,{a:e}),e}})(),(()=>{n.d=(t,e)=>{for(var o in e)n.o(e,o)&&!n.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:e[o]})}})(),(()=>{n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e)})(),(()=>{var t=n(2),e=n.n(t);function o(t){t.className=t.dataset.classes,t.innerHTML=`<div class="vdtk_download">\n<img class="base-svg" src="${chrome.runtime.getURL("assets/images/base.svg")}">\n</div>\n<strong class="bar-item-text engagement-text-v23" title="${chrome.i18n.getMessage("download")}">&nbsp;\n<span class="abs">${chrome.i18n.getMessage("download")}</span>\n</strong>`}function i(t){let e=document.createElement("img");e.src=chrome.runtime.getURL("assets/images/preloader.svg"),e.classList.add("preloader-svg"),t.querySelector(".vdtk_download").appendChild(e),t.classList.add("preload")}function a(t){this.addEventListener("click",(function(e){e.stopPropagation(),e.preventDefault(),this.classList.contains("preload")||this.classList.contains("success")||this.classList.contains("error")||(i(this),t())}))}const r=function(t){let n;switch(t){case e().m:n="vdtk_svideo";break;case e().v:n="vdtk_grid";break;case e().p:n="vdtk_single";break;case e().h:n="vdtk_4bvideo";break;case e().k:n="vdtk_embed";break;case e().$:n="vdtk_popup";break;case e().O:n="vdtk_explore";break}let i=document.createElement("div");return i.dataset.classes=`bar-item-wrapper ${n}`,i.U=a,o(i),i},c=function(t){t.classList.add("success");let e=document.createElement("img");e.src=chrome.runtime.getURL("assets/images/success.svg"),e.classList.add("success-svg"),t.querySelector(".vdtk_download").appendChild(e),setTimeout((function(e){document.body.contains(t)&&o(t)}),5e3)},s=function(t){t.classList.add("error");let e=document.createElement("img");e.src=chrome.runtime.getURL("assets/images/error.svg"),e.classList.add("error-svg"),t.querySelector(".vdtk_download").appendChild(e),setTimeout((function(e){document.body.contains(t)&&o(t)}),5e3)},d=function(t){o(t);const e=document.createElement("div");e.className="open_video_msg",t.querySelector(".vdtk_download").appendChild(e),setTimeout((function(e){document.body.contains(t)&&o(t)}),5e3)},u=function(t){o(t)};var l=n(13),_=n(1),m=n.n(_);function f(t,e=16){let n="",o=t.length;for(let i=0;i<e;i++)n+=t.charAt(Math.floor(Math.random()*o));return n}const v={B(t){if(t.filename_by_title=t.filename_by_title?t.filename_by_title:m().t(t.video_url||t.photo_url,t.author,t.title,!!t.video_url),t.filename_by_url=t.filename_by_url?t.filename_by_url:m().t(t.video_url||t.photo_url,t.author,null,!!t.video_url),!t.str_id){let e=null;t.video_id&&"string"==typeof t.video_id?e=t.video_id:t.video_id&&t.video_id[1]&&(e=t.video_id[1]),t.str_id=e}return t.fetch_opt={},t.video_url&&t.video_url.match(/webapp-prime\.(\w+\.)?tiktok\./)&&(t.fetch_opt.credentials="include",t.video_url.includes("TT-vCache")||(t.video_url+="&__vid=TT-vCache-"+t.str_id)),t},F(t,n,o,i="aweme/detail"){let a=e().I,r="v1",c=1180,s="trill",d=Math.round(Date.now()/1e3),u={aweme_id:t,version_name:n,version_code:o,build_number:n,manifest_version_code:o,update_version_code:o,openudid:f("0123456789abcdef",16),uuid:f("0123456789",16),_rticket:1e3*d,ts:d,device_brand:"Google",device_type:"Pixel 4",device_platform:"android",resolution:"1080*1920",dpi:420,os_version:"10",os_api:"29",carrier_region:"US",sys_region:"US",region:"US",app_name:s,app_language:"en",language:"en",timezone_name:"America/New_York",timezone_offset:"-14400",channel:"googleplay",ac:"wifi",mcc_mnc:"310260",is_my_cn:0,aid:c,ssmix:"a",as:"a1qwert123",cp:"cbfhckdckkde1"};return`https://${a}/aweme/${r}/${i}/`+Object.keys(u).map(((t,e)=>`${e>0?"&":"?"}${t}=${u[t]}`)).join("")},A:t=>new Promise(((e,n)=>{fetch(t).then((t=>t.json())).then((t=>e(t))).catch((t=>n(t)))}))},p={N:function(t,e){let n=this;Promise.resolve().then((()=>t.video_url?t:n.P(t).then((t=>t&&"error"!==t.status&&t.downloadObject?t.downloadObject:Promise.reject(t))))).then((t=>{t=v.B(t),this.S(t,e)}))},L:t=>new Promise(((e,n)=>{t=v.B(t),chrome.runtime.sendMessage({action:"getNoWatermarkData",videoId:t.str_id},(function(o){if(!o.success)return void n();let i=o.data;const a=["play_addr","play_addr_h264","play_addr_bytevc1","download_addr"];let r=[],c=!1;if(i&&i.aweme_list)for(const e in i.aweme_list){let n=i.aweme_list[e];if(n.aweme_id===t.str_id)for(const t in a){if(!0===c)break;n&&n.video&&n.video[a[t]]&&n.video[a[t]].url_list&&n.video[a[t]].url_list[0]&&(r=n.video[a[t]].url_list,c=!0)}}0==r.length&&n(),t.video_url=r[0],e(t)}))})),M:function(t,e){chrome.runtime.sendMessage({action:"download",downloadObject:t},e)},P:function(t){return chrome.runtime.sendMessage({action:"updateUrl",downloadObject:t})},S:function(t,e){const n=this;if(!t||!t.video_url&&!t.photo_url)return e({status:"error"});fetch(t.video_url||t.photo_url,t?.fetch_opt).then((t=>t.blob())).then((o=>{t.blob_force=!0,t.video_url?t.video_url=URL.createObjectURL(o,{type:"video/mp4"}):t.photo_url=URL.createObjectURL(o,{type:"image/jpeg"}),n.M(t,e)})).catch((t=>{e({status:"error"})}))}};var g={R:function(){let t=this;t.j(),t.D(),t.C(),chrome.tabs.query({active:!0,currentWindow:!0},(function(e){let n=e[0];chrome.tabs.sendMessage(n.id,{action:"getVideoList"},(function(e){if(chrome.runtime.lastError)return n.url.includes("tiktok.com")?void g.W(n.id):g.q();if(e.length)t.V(e);else{if(!n.url.includes("tiktok.com"))return g.q();g.G()}}))}))},C(){document.querySelector(".setting-open").addEventListener("click",(t=>{chrome.storage.sync.get("download_with_watermark").then((t=>{const e=t.download_with_watermark?"checked":"",n=document.createElement("div");function o(){n.remove(),document.querySelectorAll(".tabs-container, .reload, .not_found, .empty, .header").forEach((t=>{t.style.display=t.getAttribute("display-attr")||"flex"}))}n.className="settings",n.innerHTML=`\n<div class="settings_header">${chrome.i18n.getMessage("settings")}</div>\n<div class="settings_items_wrap">\n<div class="settings_item">\n<label for="download_with_watermark_input">\n<input id="download_with_watermark_input" type="checkbox" ${e}>\n<span class="custom_checkbox"></span>\n${chrome.i18n.getMessage("download_with_watermark_setting")}\n</label>\n</div>\n</div>\n<div class="settings_buttons_wrap">\n<button class="settings_button btn_save">${chrome.i18n.getMessage("save")}</button>\n<button class="settings_button btn_cancel">${chrome.i18n.getMessage("cancel")}</button>\n</div>`,document.querySelectorAll(".tabs-container, .reload, .not_found, .empty, .header").forEach((t=>{t.style.display="none"})),document.body.appendChild(n),n.querySelector(".btn_save").addEventListener("click",(t=>{chrome.storage.sync.set({download_with_watermark:n.querySelector("#download_with_watermark_input").checked}),o()})),n.querySelector(".btn_cancel").addEventListener("click",(t=>{o()}))}))}))},j:function(){let t=this;chrome.runtime.onMessage.addListener((e=>{"update"===e.action&&e.videoList.length&&(document.querySelectorAll(".list > li").forEach((t=>t.classList.add("delete"))),t.V(e.videoList))}))},V:function(t){let e=this;document.querySelectorAll(".empty, .reload, .delete").forEach((function(t){t.remove()})),t.length>0&&g.H(),t.forEach((function(t,n){(t.video_url||t.video_id&&!document.querySelector(`[data-id="${t.video_id}"]`)||t.photo_url&&!document.querySelector(`[data-id="${t.photo_url}"]`))&&e.J(t)}))},J:function(t){let n=document.createElement("li"),o=document.querySelector(".list");const i=t.video_id||t.photo_url,a=t.photo_url?"<div class='photo_icon'></div>":"";n.innerHTML=`<div class="media_item" data-id="${i}">\n${a}\n<div class="thumb" style="background-image:url(${t.poster});">\n</div>\n<div class="media_actions_list">\n</div>\n</div>`,o.appendChild(n);let d=n.querySelector(".media_actions_list"),l=r(e().$);l.U((function(){p.N(t,(function(t){u(l),t&&"error"!==t.status?"success"===t.status&&c(l):s(l)}))})),d.prepend(l)},W:function(t){const e=document.createElement("div");e.className="reload",e.setAttribute("display-attr","block"),e.innerHTML=`<div class="icon"></div><div class="text">${chrome.i18n.getMessage("popup_reload")}</div>`,document.body.appendChild(e),e.querySelector(".icon").addEventListener("click",(function(e){chrome.tabs.reload(t)}))},G:function(){const t=document.createElement("div");t.className="not_found",t.setAttribute("display-attr","block"),t.innerHTML=`<div class="text">${chrome.i18n.getMessage("video_not_found")}</div>`,document.body.appendChild(t)},H:function(){document.querySelector(".not_found")&&document.querySelector(".not_found").remove()},q:function(){const t=document.createElement("div");t.className="empty",t.setAttribute("display-attr","block"),t.innerHTML=`<a href="//tiktok.com"><span>${chrome.i18n.getMessage("popup_to_tiktok")}</span></a>`,document.body.appendChild(t),t.querySelector("a").addEventListener("click",(function(t){chrome.tabs.create({url:"https://www.tiktok.com"})}))},D:function(){let t=this;chrome.storage.local.get(["rate"],(e=>{e.rate||t.Y()}))},Y:function(){let t=document.createElement("div");t.classList.add("stars"),t.innerHTML='<span data-star="1"></span><span data-star="2"></span><span data-star="3"></span><span data-star="4"></span><span data-star="5"></span>',document.querySelector(".rate").append(t),document.querySelectorAll(".rate span[data-star]").forEach((function(t,e){t.addEventListener("click",(function(t){let e=t.target;for(let t=e.parentNode.firstChild;null!==t;t=t.nextSibling)t.classList.remove("select");e.classList.add("select"),e.parentElement.classList.add("active"),e.dataset.star>=4&&chrome.tabs.create({url:`https://chromewebstore.google.com/detail/${chrome.runtime.id}/reviews`}),chrome.storage.local.set({rate:e.dataset.star})}))}))}};g.R()})()})();