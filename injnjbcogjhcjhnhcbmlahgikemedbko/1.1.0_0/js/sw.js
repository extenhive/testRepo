(()=>{var e=[,e=>{e.exports=function(){let e=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,t=/[\/\?<>\\:\*\|"~]/g,r=/[\x00-\x1f\x80-\x9f]/g,n=/^\.+/,i=/^(.+)\.([a-z0-9]{1,4})$/i,o=/^[^.!?]+/i,a="nbsp,iexcl,cent,pound,curren,yen,brvbar,sect,uml,copy,ordf,laquo,not,shy,reg,macr,deg,plusmn,sup2,sup3,acute,micro,para,middot,cedil,sup1,ordm,raquo,frac14,frac12,frac34,iquest,Agrave,Aacute,Acirc,Atilde,Auml,Aring,AElig,Ccedil,Egrave,Eacute,Ecirc,Euml,Igrave,Iacute,Icirc,Iuml,ETH,Ntilde,Ograve,Oacute,Ocirc,Otilde,Ouml,times,Oslash,Ugrave,Uacute,Ucirc,Uuml,Yacute,THORN,szlig,agrave,aacute,acirc,atilde,auml,aring,aelig,ccedil,egrave,eacute,ecirc,euml,igrave,iacute,icirc,iuml,eth,ntilde,ograve,oacute,ocirc,otilde,ouml,divide,oslash,ugrave,uacute,ucirc,uuml,yacute,thorn,yuml".split(","),c=[["amp","quot","lt","gt"],[38,34,60,62]],s=/&([^;]{2,6});/g,u=/\r?\n/g,_=/[\*\?"]/g,l=/</g,d=/>/g,f=/[\s\t\uFEFF\xA0]+/g,p=/(\.|!|\?|_|,|\-|:|\+){2,}/g,m=/[\.,:;\/\-_\+=']$/g,h=55,g=function(t){return t.replace(e,"")},v=function(e){return e.match(i)},$=function(e){var t=/\\(\\u[0-9a-f]{4})/g;try{return JSON.parse(JSON.stringify(e).replace(t,"$1"))}catch(t){return e}},b=function(e){return e.replace(s,(function(e,t){var r=null;if("#"===t[0])return r=parseInt(t.substr(1)),isNaN(r)?"":String.fromCharCode(r);var n=c[0].indexOf(t);return-1!==n?(r=c[1][n],String.fromCharCode(r)):-1!==(n=a.indexOf(t))?(r=n+160,String.fromCharCode(r)):""}))};return{t:function(e,t,r,n){const i=n?".mp4":".jpeg";let o="video_keeper_"+(t=t?`${t}_`:""),a;if(r=r?`_${this.i(r)}`:"")a=this.u(o+r)+i;else if(e)try{let t=new URL(e);a=null==t.searchParams.get("br")?o+t.pathname.split("/")[1]+"_"+(t.pathname.split("/")[3]||"")+i:o+t.searchParams.get("br")+"_"+t.searchParams.get("bt")+i}catch(e){}return a||(a=o+Math.round(1e5*Math.random())+i),a},u:e=>e.slice(0,h),i:function(e){if(!e)return"";e=$(e);try{e=decodeURIComponent(e)}catch(t){e=unescape(e)}return e=(e=b(e)).replace(u," "),(e=(e=(e=g(e)).replace(_,"").replace(l,"(").replace(d,")").replace(f," ").replace(p,"$1").replace(t,"_").replace(r,"").replace(n,"").replace(m,"")).replace(/[^\p{L}\p{N}\p{P}\p{Z}^$\n]/gu,"")).length<=h?e:e=(e=e.match(o))&&e[0]}}}()},e=>{e.exports=function(){return{_:"26.1.3",l:"260103",p:1,m:2,h:3,v:4,$:5,k:6,S:7,U:1988}}()},e=>{e.exports=function(){return{O:function(e,t){t&&!Array.isArray(t)&&(t=[t]);for(var r=[],n={"{":0,"[":0},i={"}":"{","]":"["},o=/[{}\]\[":0-9.,-]/,a=/[\r\n\s\t]/,c="",s=0,u;u=e[s];s++)if('"'!==u)o.test(u)?(c+=u,"{"===u||"["===u?(n["{"]||n["["]||(c=u),n[u]++):"}"!==u&&"]"!==u||(n[i[u]]--,n["{"]||n["["]||r.push(c))):"t"===u&&"true"===e.substr(s,4)?(c+="true",s+=3):"f"===u&&"false"===e.substr(s,5)?(c+="false",s+=4):"n"===u&&"null"===e.substr(s,4)?(c+="null",s+=3):a.test(u)||(n["{"]=0,n["["]=0,c="");else{for(var _=s;-1!==_&&(_===s||"\\"===e[_-1]);)_=e.indexOf('"',_+1);-1===_&&(_=e.length-1),c+=e.substr(s,_-s+1),s=_}for(var l=[],s=0,d;d=r[s];s++)if("{}"!==d&&"[]"!==d)try{t?t.every((function(e){return e.test(d)}))&&l.push(JSON.parse(d)):l.push(JSON.parse(d))}catch(e){}return l},I:function(){var e,t,r="",n=""+parseFloat(navigator.userAgent.match(/\d+\.\d+/)[0]),i=navigator.userAgent;return-1!==i.indexOf("Edge")||-1!==i.indexOf("Edg")?(r="Microsoft Edge",-1!==i.indexOf("Edge")?(e=i.indexOf("Edge"),n=i.substring(e+5)):(e=i.indexOf("Edg"),n=i.substring(e+4))):-1!==(e=i.indexOf("MSIE"))?(r="Microsoft Internet Explorer",n=i.substring(e+5)):-1!==i.indexOf("Chrome")?-1!==(e=i.indexOf("Chrome"))&&(r="Chrome",n=i.substring(e+7)):-1!==i.indexOf("Safari")?-1!==(e=i.indexOf("Safari"))&&(r="Safari",n=i.substring(e+7),-1!==(e=i.indexOf("Version"))&&(n=i.substring(e+8))):-1!==(e=i.indexOf("Firefox"))&&(r="Firefox",n=i.substring(e+8)),-1!==(t=n.indexOf(";"))&&(n=n.substring(0,t)),-1!==(t=n.indexOf(" "))&&(n=n.substring(0,t)),-1!==(t=n.indexOf(")"))&&(n=n.substring(0,t)),{browser:r,browser_version:n,full_browser_version:navigator.userAgent.match(/\d+\..+/)[0]}},P:()=>Promise.resolve().then((function(){return navigator.getBattery?navigator.getBattery():1})),T:function(e,t,r){function n(e,n){var i=parseInt(e[t]),o=parseInt(n[t]);return r?i<o?1:i>o?-1:0:i>o?1:i<o?-1:0}e.sort(n)}}}()},(e,t,r)=>{const n=r(2);e.exports=function(){return{A(e){chrome.tabs.get(e.tabId).then((function(t){if(chrome.runtime.lastError||!t||!t.url)return;let r=t.url.match(/tiktok\.com\/@([^/?#]+)/);r=r&&r[1];let n=new URLSearchParams(e.url).get("secUid");r&&n&&chrome.storage.local.get("secUids").then((e=>{const t=e.secUids||{};t[r]=n,chrome.storage.local.set({secUids:t})}))}))},F:e=>chrome.storage.local.get("secUids").then((t=>{const r=void 0;return{secUid:(t.secUids||{})[e]}}))}}()},(e,t,r)=>{const n=r(2);e.exports=function(){const e={bulk_insert_place_1:'[class*="DivButtonPanelWrapper"]',bulk_insert_place_2:'[class*="DivUserTextWrapper"]',bulk_insert_place_3:'[class*="DivHeaderWrapperMain"]',bulk_insert_place_before_child:'[class*="DivHeaderCenterContainer"]',feed_page_id_container:"[id^=xgwrapper]",feed_page_id_attribute:"id",feed_page_id_regex:"(\\d+)$",feed_page_title_container:'[data-e2e="video-desc"]',player_button:"button",grid_page_title_container:'[class*="MetaCaptionLine"]',single_video_title_container:'[data-e2e="browse-video-desc"]',explore_video_title_container:'[data-e2e="explore-card-video-caption"]',explore_video_author_container:'[data-e2e="explore-card-user-unique-id"]',embed_title_container:'[data-testid="card-component"] .LinesEllipsis',embed_btn_parent:'[data-testid="layer-component"] > div',recommend_list_item_container:'[data-e2e="recommend-list-item-container"]'};return{N:()=>chrome.storage.local.get(n.L).then((t=>{if(!t[n.L])return chrome.storage.local.set({[n.L]:e})})),B:()=>chrome.storage.local.get(n.L).then((t=>t[n.L]||e))}}()}],t={};function r(n){var i=t[n];if(void 0!==i)return i.exports;var o=t[n]={exports:{}};return e[n](o,o.exports,r),o.exports}(()=>{r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t}})(),(()=>{r.d=(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})}})(),(()=>{r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t)})(),(()=>{var e=r(1),t=r.n(e),n=r(2),i=r.n(n);function o(e,t=16){let r="",n=e.length;for(let i=0;i<t;i++)r+=e.charAt(Math.floor(Math.random()*n));return r}const a={D(e){if(e.filename_by_title=e.filename_by_title?e.filename_by_title:t().t(e.video_url||e.photo_url,e.author,e.title,!!e.video_url),e.filename_by_url=e.filename_by_url?e.filename_by_url:t().t(e.video_url||e.photo_url,e.author,null,!!e.video_url),!e.str_id){let t=null;e.video_id&&"string"==typeof e.video_id?t=e.video_id:e.video_id&&e.video_id[1]&&(t=e.video_id[1]),e.str_id=t}return e.fetch_opt={},e.video_url&&e.video_url.match(/webapp-prime\.(\w+\.)?tiktok\./)&&(e.fetch_opt.credentials="include",e.video_url.includes("TT-vCache")||(e.video_url+="&__vid=TT-vCache-"+e.str_id)),e},C(e,t,r,n="aweme/detail"){let a=i().R,c="v1",s=1180,u="trill",_=Math.round(Date.now()/1e3),l={aweme_id:e,version_name:t,version_code:r,build_number:t,manifest_version_code:r,update_version_code:r,openudid:o("0123456789abcdef",16),uuid:o("0123456789",16),_rticket:1e3*_,ts:_,device_brand:"Google",device_type:"Pixel 4",device_platform:"android",resolution:"1080*1920",dpi:420,os_version:"10",os_api:"29",carrier_region:"US",sys_region:"US",region:"US",app_name:u,app_language:"en",language:"en",timezone_name:"America/New_York",timezone_offset:"-14400",channel:"googleplay",ac:"wifi",mcc_mnc:"310260",is_my_cn:0,aid:s,ssmix:"a",as:"a1qwert123",cp:"cbfhckdckkde1"};return`https://${a}/aweme/${c}/${n}/`+Object.keys(l).map(((e,t)=>`${t>0?"&":"?"}${e}=${l[e]}`)).join("")},M:e=>new Promise(((t,r)=>{fetch(e).then((e=>e.json())).then((e=>t(e))).catch((e=>r(e)))}))};var c=r(3),s=r.n(c);const u={j:{},q:e=>new Promise((function(t,r){chrome.downloads.download(e,(function(e){if(chrome.runtime.lastError)return r("runtime.lastError");e?t(e):r("No downloadId")}))})),J:function(e,t){let r=this;e=a.D(e),new Promise((function(t,n){if(!e.filename_by_title)throw"No filename by title";r.q({url:e.video_url||e.photo_url,filename:e.filename_by_title}).then(t).catch(n)})).catch((function(t){if(!e.filename_by_url)throw"No filename by url";return r.q({url:e.video_url||e.photo_url,filename:e.filename_by_url})})).catch((function(t){return r.q({url:e.video_url})})).then((function(n){r.j[n]={time:Date.now(),opts:e,callback:t}})).catch((function(){t({status:"error",opts:e})}))},W(e,t){let r=new AbortController,n=r.signal,i,o=setTimeout((()=>r.abort()),3e3),a;chrome.storage.sync.get("download_with_watermark").then((r=>(a=!!r.download_with_watermark,a||!e.video_url||!e.blob_force&&0!==e.video_url.indexOf("https")?e.post_url?fetch(e.post_url,{signal:n}).then((e=>(clearTimeout(o),e.text()))).then((r=>{const n=s().O(r);let i,o=r.match(/<script\s*id="__UNIVERSAL_DATA_FOR_REHYDRATION__"\s*type="application\/json">([^<]+)<\/script>/);o=o&&o[1];try{o=JSON.parse(o),i=o.__DEFAULT_SCOPE__["webapp.video-detail"].itemInfo.itemStruct}catch(e){o=null}if(i){e.title=i.desc;let t="",r="";t=i.video.downloadAddr;try{i.video.bitrateInfo&&(s().T(i.video.bitrateInfo,"Bitrate",!0),r=i.video.bitrateInfo[0].PlayAddr.UrlList[0])}catch(e){}r=r||i.video.playAddr,e.video_url=a?t||r:r||t}else{let t=s().O(r),n=e.post_url.match(/\/video\/(\d+)/);n=n&&n[1];let o=t.find((function(e){return e.ItemModule}));n&&(i=o&&o.ItemModule[n]),i||(i=o&&Object.values(o.ItemModule)[0]),i?(e.video_url=a?i.video&&i.video.downloadAddr:i.video&&i.video.playAddr,e.title=i.desc):(t=t.filter((e=>e.Bitrate)),s().T(t,"Bitrate",!0),i=t[0],i&&(e.video_url=i.PlayAddr&&i.PlayAddr.UrlList&&i.PlayAddr.UrlList[0]))}return t(e)})):Promise.reject("no post_url"):t(e)))).catch((r=>{t(e)}))},H:function(e,t){let r=this;if(!e||!e.photo_url&&!e.video_url&&!e.post_url)return t({status:"error"});r.W(e,(function(e){if(!e||!e.video_url&&!e.photo_url)return t({status:"error"});r.J(e,t)}))},G(){let e=this;chrome.downloads.onChanged.addListener((function(t){if(e.j[t.id]){let r;if(t.error&&"USER_CANCELED"===t.error.current&&Date.now()>e.j[t.id].time+300)r="cancelled";else if(t.error)r="error";else{if(!t.state||"complete"!==t.state.current)return;r="success"}e.j[t.id].callback({status:r,opts:e.j[t.id].opts}),delete e.j[t.id]}}))}},_={V:!1,X:[],Y:null,Z:null,K:0,ee:0,te:function(e){return e(this.V)},G:function(e){let t=this;t.V||(t.V=!0,t.Y=e,t.Z=e.sender.tab.id,this.re(t.Z,"bulkProcessStarted"),t.Y.onMessage.addListener((function(e){"ping"===e?t.Y.postMessage("pong"):"start"===e.action?t.ne(e.downloadList):"stop"===e.action&&t.ie()})),t.Y.onDisconnect.addListener((function(){t.ie()})))},ne(e){let t=this;t.X=e,t.K=e.length,t.oe({ae:function(){t.V&&(t.ee++,t.Y.postMessage({type:"step",count:t.ee}))},ce:function(){t.V&&(t.Y.postMessage({type:"finish"}),t.ie())}})},ie:function(){this.re(this.Z,"bulkProcessFinished"),this.V=!1,this.X=[],this.Y=null,this.Z=null,this.K=0,this.ee=0},oe(e){let t=this;if(!t.X.length)return e.ce();let r=t.X.shift();r=a.D(r),chrome.tabs.sendMessage(t.Z,{action:"downloadByFetch",data:r},(function(r){r&&"success"===r.status&&e.ae(),t.oe(e)}))},re:function(e,t){chrome.tabs.query({url:"https://*.tiktok.com/*"},(function(r){r.forEach((function(r){e!==r.id&&chrome.tabs.sendMessage(r.id,{action:t},(function(){if(chrome.runtime.lastError)return!1}))}))}))}};var l=r(4),d=r.n(l),f=r(5),p=r.n(f);const m=void 0;({G(){const e=this;p().N().then((()=>{e.se(),u.G()}))},se(){this.ue(),this._e(),this.le(),this.de()},de(){chrome.tabs.onUpdated.addListener(((e,t,r)=>{t.url&&t.url.includes("tiktok.com")&&"loading"===t.status&&chrome.tabs.sendMessage(e,{action:"pageUpdated"}).catch((e=>{}))}))},ue(){chrome.runtime.onMessage.addListener((function(e,t,r){switch(e.action){case"openStore":chrome.tabs.create({url:"https://chromewebstore.google.com/detail/"+chrome.runtime.id+"/reviews"});break;case"download":return u.H(e.downloadObject,r),!0;case"isBulkInProcess":return _.te(r),!0;case"goToDownloadsSettings":chrome.tabs.create({url:"chrome://settings/downloads"});break;case"updateUrl":return u.W(e.downloadObject,(function(e){r({downloadObject:e})})),!0;case"getSecUid":return d().F(e.uniqueId).then((e=>r(e))),!0;case"getNoWatermarkData":let t=a.C(e.videoId,i()._,i().l,"feed");return a.M(t).then((e=>r({success:!0,data:e}))).catch((e=>r({success:!1,data:e}))),!0;case"get_browser":r(s().I());break;case"get_battery_level":return s().P().then((e=>{r(e)})),!0}}))},_e(){chrome.runtime.onConnect.addListener((function(e){e.sender.id===chrome.runtime.id&&e.name.includes("bulk_download")&&_.G(e)}))},le(){chrome.webRequest.onCompleted.addListener(d().A,{urls:["https://www.tiktok.com/api/post/item_list/*"],types:["xmlhttprequest"]})}}).G()})()})();